<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BalanÃ§o de Estoque</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-lg">
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <h1 class="text-3xl font-extrabold text-gray-800">ðŸ“Š BalanÃ§o de Estoque</h1>
            <button onclick="gerarPDF()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition">
                ðŸ“„ Exportar PDF
            </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 bg-blue-50 p-4 rounded-lg border border-blue-100">
            <input id="nome" type="text" placeholder="Nome do Produto" class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400">
            <input id="qtd" type="number" placeholder="Qtd" class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400">
            <input id="preco" type="number" step="0.01" placeholder="PreÃ§o UnitÃ¡rio" class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400">
            <button onclick="adicionar()" class="bg-blue-600 text-white font-bold p-2 rounded hover:bg-blue-700 transition">Adicionar Registro</button>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-left" id="tabela-estoque">
                <thead>
                    <tr class="bg-gray-800 text-white">
                        <th class="p-3">Produto</th>
                        <th class="p-3">Qtd</th>
                        <th class="p-3">PreÃ§o Unit.</th>
                        <th class="p-3">Subtotal</th>
                        <th class="p-3 text-center">AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="lista-estoque" class="divide-y divide-gray-200"></tbody>
            </table>
        </div>
    </div>

    <script>
        let estoque = JSON.parse(localStorage.getItem('meuEstoque')) || [];

        function renderizar() {
            const lista = document.getElementById('lista-estoque');
            lista.innerHTML = '';
            estoque.forEach((item, index) => {
                const total = (item.qtd * item.preco).toFixed(2);
                lista.innerHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3 font-medium">${item.nome}</td>
                        <td class="p-3">${item.qtd}</td>
                        <td class="p-3">R$ ${parseFloat(item.preco).toFixed(2)}</td>
                        <td class="p-3 text-blue-600 font-bold">R$ ${total}</td>
                        <td class="p-3 text-center">
                            <button onclick="remover(${index})" class="text-red-500 hover:underline">Remover</button>
                        </td>
                    </tr>`;
            });
            localStorage.setItem('meuEstoque', JSON.stringify(estoque));
        }

        function adicionar() {
            const nome = document.getElementById('nome').value;
            const qtd = document.getElementById('qtd').value;
            const preco = document.getElementById('preco').value;

            if(nome && qtd && preco) {
                estoque.push({ 
                    nome, 
                    qtd: parseInt(qtd), 
                    preco: parseFloat(preco),
                    data: new Date().toLocaleDateString('pt-BR') 
                });
                renderizar();
                document.getElementById('nome').value = '';
                document.getElementById('qtd').value = '';
                document.getElementById('preco').value = '';
            }
        }

        function remover(index) {
            estoque.splice(index, 1);
            renderizar();
        }

        async function gerarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // ConfiguraÃ§Ãµes do CabeÃ§alho do PDF
            doc.setFontSize(18);
            doc.text("RelatÃ³rio de BalanÃ§o de Estoque", 14, 20);
            
            doc.setFontSize(11);
            doc.setTextColor(100);
            doc.text(`Data de emissÃ£o: ${new Date().toLocaleString('pt-BR')}`, 14, 28);

            // Preparar dados para a tabela do PDF
            const colunas = ["Produto", "Qtd", "PreÃ§o Unit.", "Total"];
            const linhas = [];
            let valorTotalGeral = 0;

            estoque.forEach(item => {
                const total = item.qtd * item.preco;
                valorTotalGeral += total;
                linhas.push([
                    item.nome,
                    item.qtd,
                    `R$ ${item.preco.toFixed(2)}`,
                    `R$ ${total.toFixed(2)}`
                ]);
            });

            // Gerar a tabela no PDF
            doc.autoTable({
                head: [colunas],
                body: linhas,
                startY: 35,
                theme: 'striped',
                headStyles: { fillColor: [31, 41, 55] } // Cor cinza escuro do Tailwind
            });

            // Adicionar valor total geral ao final
            const finalY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.setFont("helvetica", "bold");
            doc.text(`VALOR TOTAL DO ESTOQUE: R$ ${valorTotalGeral.toFixed(2)}`, 14, finalY);

            // Baixar o arquivo
            doc.save(`balanco_estoque_${new Date().getTime()}.pdf`);
        }

        renderizar();
    </script>
</body>
</html>
